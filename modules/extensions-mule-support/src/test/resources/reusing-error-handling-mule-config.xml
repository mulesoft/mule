<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns:this="http://www.mulesoft.org/schema/mule/this"
      xmlns:operation="http://www.mulesoft.org/schema/mule/operation"
      xmlns:heisenberg="http://www.mulesoft.org/schema/mule/heisenberg"
      xmlns="http://www.mulesoft.org/schema/mule/core"
      xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
          http://www.mulesoft.org/schema/mule/operation http://www.mulesoft.org/schema/mule/operation/current/mule-operation.xsd
          http://www.mulesoft.org/schema/mule/heisenberg http://www.mulesoft.org/schema/mule/heisenberg/current/mule-heisenberg.xsd
          http://www.mulesoft.org/schema/mule/this http://www.mulesoft.org/schema/mule/this/current/mule-this.xsd">

  <flow name="reusableErrorHandlerAsAnOperationFlow">
    <this:operation-one />
  </flow>

  <operation:def name="operationOne">
    <operation:output>
      <operation:payload-type type="void"/>
    </operation:output>
    <operation:body>
      <try>
        <heisenberg:cure-cancer />
        <error-handler>
          <on-error-continue>
            <this:handle-error error="#[error]" />
          </on-error-continue>
        </error-handler>
      </try>
    </operation:body>
  </operation:def>

  <operation:def name="operationTwo">
    <operation:output>
      <operation:payload-type type="void"/>
    </operation:output>
    <operation:body>
      <try>
        <heisenberg:kill-with-ricins />
        <error-handler>
          <on-error-continue>
            <this:handle-error error="#[error]" />
          </on-error-continue>
        </error-handler>
      </try>
    </operation:body>
  </operation:def>

  <operation:def name="handleError">
    <operation:parameters>
      <operation:parameter name="error" type="error" />
    </operation:parameters>
    <operation:output>
      <operation:payload-type type="void"/>
    </operation:output>
    <operation:body>
      <choice>
        <when expression="#[params.error causedBy 'HEISENBERG:HEALTH']" >
          <logger level="ERROR" message="Caught error!" />
        </when>
        <otherwise>
          <operation:raise-error type="UNKNOWN" />
        </otherwise>
      </choice>
    </operation:body>
  </operation:def>
</mule>
